$(function(){window.get_videos_list=function(){var e=[];return $("#videolist .video-entry").each(function(t,n){if(!$(this).is(".video-error")&&$(this).attr("data-status")){var r="";$(this).attr("data-new")=="false"&&(r=$(this).attr("data-id")),e.push({id:r,status:$(this).attr("data-status"),service:$(this).attr("data-service"),video_id:$(this).attr("data-video-id"),video_url:$(this).attr("data-video-url"),thumbnail_url:$(this).attr("data-thumbnail-url"),title:$(this).attr("data-title"),description:$(this).attr("data-description")})}}),e};var e=0;window.has_video=function(e){return $("#videolist").find("div[id="+e.video_id+"][data-service="+e.service+"]").length>0},window.add_video=function(t){var n=!1;t.id===undefined&&(t.id="new_"+e++,t.status="modified",n=!0),$("#videolist").append('<div id="'+t.video_id+'" class="video-entry" data-video-id="'+t.video_id+'" data-id="'+t.id+'" data-status="'+t.status+'" data-new="'+n+'" data-service="'+t.service+'" data-title="'+t.title+'" data-description="'+t.description+'" data-video-url="'+t.video_url+'" data-thumbnail-url="'+t.thumbnail_url+'">'+'<strong class="video-title">'+t.title+"</strong>"+'<img src="'+t.thumbnail_url+'" alt="img" class="video-thumb">'+"</div>")},$(".add-new-video-link").click(function(){var e=$("<input type='text' class='video-link' name='video_link'>");$(".video-link-list").append(e),e.focus()}),$("#add_videos_from_links").click(function(e){var t=[],n=[];return $(".video-modal input[name=video_link]").each(function(e,r){var i=$(r).val();if(i.search("iframe")!=-1){var s=$(i);i=s.attr("src")}if(i){var o=$.post(dutils.urls.resolve("video_url_info"),{video_url:i,csrfmiddlewaretoken:getCookie("csrftoken")},function(e){e.success?has_video(e.video)||add_video(e.video):n.push(i)},"json");t.push(o)}}),$.when.apply($,t).then(function(){if(n.length){var e=n.join(", ");errorMessage(gettext("Invalid URL"),interpolate(gettext("The following urls could not be resolved as valid videos: %s"),[e]))}}),$(".video-modal").modal("hide"),$(".video-modal input").remove(),$(".video-link-list").append("<input type='text' class='video-link' name='video_link'>"),!1}),$(".close").live("click",function(){$(this).parent().slideUp()}),$(".video-entry").live("click",function(e){if(isAuthenticated){var t=$(this).attr("data-id"),n=$(this).attr("data-title"),r=$(this).attr("data-description"),i=$(this).attr("data-thumbnail-url");return $("#title-modal #video-title-modal").attr("src",i),$("#title-modal #id_title").val(n||""),$("#title-modal #id_video_description").val(r||""),$("#title-modal #id_title").attr("data-id",t),$("#title-modal #id_video_description").attr("data-id",t),$("#title-modal #delete-video").attr("data-id",t),$("#title-modal").modal("show"),!1}return e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),url=document.location.pathname,$("#login-box #login-button").attr("href","/user/login?next="+url),$("#login-box").dialog({width:850,modal:!0,resizable:!1,draggable:!1}),!1}),$("#save-title").live("click",function(){var e=$("#title-modal #id_title").attr("data-id"),t=$("#title-modal #id_title").val(),n=$("#title-modal #id_video_description").val(),r=$("#videolist .video-entry[data-id="+e+"]");return r.attr("data-title",t).attr("data-description",n),r.attr("data-status","modified"),r.find(".video-title").text(t),$("#title-modal").modal("hide"),!1}),$("#delete-video").live("click",function(){if(confirm(gettext("Are you sure that you want to remove this video?"))){var e=$(this).attr("data-id"),t=$("#videolist .video-entry[data-id="+e+"]"),n=t.attr("data-new");n=="true"?t.remove():(t.attr("data-status","deleted"),t.hide()),$("#title-modal").modal("hide")}return!1}),$("form").submit(function(e){$("#id_videos_list").val(JSON.stringify(get_videos_list()))})});