define(["require","googlemaps","./geometries"],function(e){var t,n,r,i,s,o,u,a;return i=e("googlemaps"),r=e("./geometries"),(u=window.komoo)==null&&(window.komoo={}),(a=(o=window.komoo).event)==null&&(o.event=i.event),s=0,n={minZoomPoint:0,maxZoomPoint:10,minZoomIcon:10,maxZoomIcon:100,minZoomGeometry:0,maxZoomGeometry:100},t=function(){function e(e){var t;this.options=e!=null?e:{},this.uid=s++,t=this.options.geometry,this.setFeatureType(this.options.featureType),this.options.geojson&&(this.options.geojson.properties&&this.setProperties(this.options.geojson.properties),t==null&&(t=r.makeGeometry(this.options.geojson,this))),t!=null&&(this.setGeometry(t),this.createMarker())}return e.prototype.displayTooltip=!0,e.prototype.displayInfoWindow=!0,e.prototype.createMarker=function(){var e,t;return void 0},e.prototype.initEvents=function(e){var t,n;return e==null&&(e=this.geometry),n=this,t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick","drag","dragend","draggable_changed","dragstart","coordinates_changed"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},e.prototype.getGeometry=function(){return this.geometry},e.prototype.setGeometry=function(e){return this.geometry=e,this.geometry.feature=this,this.initEvents()},e.prototype.getGeometryType=function(){return this.geometry.getGeometryType()},e.prototype.getFeatureType=function(){return this.featureType},e.prototype.setFeatureType=function(e){this.featureType=e!=null?e:n},e.prototype.getMarker=function(){return this.marker},e.prototype.setMarker=function(e){return this.marker=e,this.marker.getOverlay().feature=this,this.initEvents(this.marker),this.marker.setVisible(this.markerShouldBeVisible()),this.marker},e.prototype.handleGeometryEvents=function(){var e=this;return komoo.event.addListener(this.geometry,"coordinates_changed",function(t){return e.updateIcon(),komoo.event.trigger(e,"coordinates_changed",t)})},e.prototype.getUrl=function(){var e;return e="view_"+this.properties.type.toLowerCase(),dutils.urls.resolve(e,{id:this.properties.id}).replace("//","/")},e.prototype.isHighlighted=function(){return this.highlighted},e.prototype.highlight=function(){return this.setHighlight(!0)},e.prototype.setHighlight=function(e,t){t==null&&(t=!1);if(this.highlighted===e)return;this.highlighted=e,this.updateIcon();if(!t)return komoo.event.trigger(this,"highlight_changed",this.highlighted)},e.prototype.isNew=function(){return!this.getProperty("id")},e.prototype.getIconUrl=function(e){var t,n,r,i;return this.getProperty("image")?this.getProperty("image"):(e==null&&(e=this.map?this.map.getZoom():10),r=e>=this.featureType.minZoomIcon?"near":"far",n=this.isHighlighted()?"highlighted/":"",t=this.properties.type.toLowerCase(),i=("/static/img/"+r+"/"+n+t+".png").replace(" ","-"),i)},e.prototype.createIcon=function(e){return this.geometry.createIcon(e,this.isHighlighted())},e.prototype.updateIcon=function(e){return this.setIcon(this.createIcon(e))},e.prototype.getCategoriesIcons=function(){var e,t,n,r,i;r=this.getCategories(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push("/static/img/need_categories/"+category.name.toLowerCase()+".png");return i},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(e){this.properties=e},e.prototype.getProperty=function(e){return this.properties[e]},e.prototype.setProperty=function(e,t){return this.properties[e]=t},e.prototype.getType=function(){return this.getProperty("type")},e.prototype.getCategories=function(){var e;return(e=this.getProperty("categories"))!=null?e:[]},e.prototype.getGeometryGeoJson=function(){return this.geometry.getGeoJson()},e.prototype.getGeometryCollectionGeoJson=function(){return{type:"GeometryCollection",geometries:[this.getGeometryGeoJson()]}},e.prototype.getGeoJsonGeometry=function(){return this.getGeometryGeoJson()},e.prototype.getGeoJson=function(){return{type:"Feature",geometry:this.getGeometryGeoJson(),properties:this.getProperties()}},e.prototype.getGeoJsonFeature=function(){return this.getGeoJson()},e.prototype.setEditable=function(e){return this.editable=e,this.geometry.setEditable(this.editable)},e.prototype.showGeometry=function(){return this.geometry.setMap(this.map)},e.prototype.hideGeometry=function(){return this.geometry.setMap(null)},e.prototype.showMarker=function(){var e;return(e=this.marker)!=null&&e.setMap(this.map),this.marker.setVisible(this.markerShouldBeVisible())},e.prototype.hideMarker=function(){return this.marker.setVisible(!1)},e.prototype.getMap=function(){return this.map},e.prototype.setMap=function(e,t){var n;t==null&&(t={geometry:!1,point:!1,icon:!1});if(e===this.geometry.getMap())return;this.oldMap=this.map,e!=null&&(this.map=e),(n=this.marker)!=null&&n.setMap(e),this.geometry.setMap(e),this.updateIcon();if(this.oldMap===void 0)return this.handleMapEvents()},e.prototype.isOutOfBounds=function(){return this.outOfBounds},e.prototype.setOutOfBounds=function(e){return this.outOfBounds=e,this.outOfBounds?this.setMap(null):(this.setMap(this.oldMap),this.setVisible(this.visible))},e.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("feature_highlight_changed",function(t,n){if(n===e)return;if(e.isHighlighted())return e.setHighlight(!1,!0)})},e.prototype.getBounds=function(){return this.geometry.getBounds()},e.prototype.removeFromMap=function(){var e;return(e=this.marker)!=null&&e.setMap(null),this.setMap(null)},e.prototype.markerShouldBeVisible=function(){var e,t,n,r,i;return((e=this.map)!=null?e.type:void 0)==="preview"||this.featureType.minZoomPoint<=(t=(n=this.map)!=null?n.getZoom():void 0)&&t<=this.featureType.maxZoomPoint||this.featureType.minZoomIcon<=(r=(i=this.map)!=null?i.getZoom():void 0)&&r<=this.featureType.maxZoomIcon},e.prototype.setVisible=function(e){var t,n,r,i,s;return this.editable?(n=!0,t=this):(i=(r=this.map)!=null?r.triggerHooks("before_feature_setVisible",this,e):void 0,t=i[0],n=i[1]),this.visible=n,(s=this.marker)!=null&&s.setVisible(n&&this.markerShouldBeVisible()),this.geometry.setVisible(n)},e.prototype.getCenter=function(){return this.geometry.getCenter()},e.prototype.setOptions=function(e){return this.geometry.setOptions(e)},e.prototype.getIcon=function(){return this.geometry.getIcon()},e.prototype.setIcon=function(e){var t;return(t=this.marker)!=null&&t.setIcon(e),this.geometry.setIcon(e)},e.prototype.setBorderSize=function(e){this.borderSize=e},e.prototype.getBorderSize=function(){var e;return(e=this.borderSize)!=null?e:this.featureType.border_size},e.prototype.setBorderSizeHover=function(e){this.borderSizeHover=e},e.prototype.getBorderSizeHover=function(){var e;return(e=this.borderSizeHover)!=null?e:this.featureType.borderSizeHover},e.prototype.setBorderColor=function(e){this.borderColor=e},e.prototype.getBorderColor=function(){var e;return(e=this.borderColor)!=null?e:this.featureType.borderColor},e.prototype.setBorderOpacity=function(e){this.borderOpacity=e},e.prototype.getBorderOpacity=function(){var e;return(e=this.borderOpacity)!=null?e:this.featureType.borderOpacity},e.prototype.setBackgroundColor=function(e){this.backgroundColor=e},e.prototype.getBackgroundColor=function(){var e;return(e=this.backgroundColor)!=null?e:this.featureType.backgroundColor},e.prototype.setBackgroundOpacity=function(e){this.backgroundOpacity=e},e.prototype.getBackgroundOpacity=function(){var e;return(e=this.backgroundOpacity)!=null?e:this.featureType.backgroundOpacity},e.prototype.setDefaultZIndex=function(e){this.defaultZIndex=e},e.prototype.getDefaultZIndex=function(){var e;return(e=this.defaultZIndex)!=null?e:this.featureType.zIndex},e.prototype.refresh=function(){return this.geometry.refresh()},e}(),window.komoo.features={Feature:t,makeFeature:function(e,t){var n;return new komoo.features.Feature({geojson:e,featureType:t!=null?t[e!=null?(n=e.properties)!=null?n.type:void 0:void 0]:void 0})}},window.komoo.features});