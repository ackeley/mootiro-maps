var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define(["require","googlemaps","./common","./multimarker","./multipolyline"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;return w=e("googlemaps"),y=e("./common"),e("./multimarker"),e("./multipolyline"),(S=window.komoo)==null&&(window.komoo={}),(x=(E=window.komoo).event)==null&&(E.event=w.event),t=y.geometries.types.EMPTY,h=y.geometries.types.POINT,a=y.geometries.types.MULTIPOINT,p=y.geometries.types.POLYGON,d=y.geometries.types.LINESTRING,i=y.geometries.types.LINESTRING,f=y.geometries.types.MULTILINESTRING,u=y.geometries.types.MULTILINESTRING,o=510072000000001,b={BACKGROUND_COLOR:"#000",BACKGROUND_OPACITY:.6,BORDER_COLOR:"#000",BORDER_OPACITY:.6,BORDER_SIZE:1.5,BORDER_SIZE_HOVER:2.5,ZINDEX:1},r=function(){function e(e){var t;this.options=e!=null?e:{},this.setFeature(this.options.feature),this.area=(t=this.options.area)!=null?t:0,this.initOverlay(this.options)}return e.prototype.initOverlay=function(e){throw"Not Implemented"},e.prototype.refresh=function(e){return this.setOptions(this.getOverlayOptions()),this.updateIcon(e)},e.prototype.getCoordinates=function(){throw"Not Implemented"},e.prototype.setCoordinates=function(e){return komoo.event.trigger(this,"coordinates_changed")},e.prototype.setEditable=function(e){throw"Not Implemented"},e.prototype.initEvents=function(e){var t,n=this;e==null&&(e=this.overlay);if(!e)return;return t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},e.prototype.calculateBounds=function(){var e,t,n,r,i,s,o,u,a,l,c,h,d,v;s=a=l=n=null,i=function(e){return s==null&&(s=a!=null?a:a=e[0]),l==null&&(l=n!=null?n:n=e[1]),s=Math.max(e[0],s),a=Math.min(e[0],a),l=Math.min(e[1],l),n=Math.max(e[1],n),[[a,l],[s,n]]},t=this.getCoordinates(),r=this.getGeometryType(),r!==p&&r!==f&&(t=[t]);for(c=0,d=t.length;c<d;c++){o=t[c];for(h=0,v=o.length;h<v;h++)u=o[h],e=i(u)}return e!=null&&(this.bounds=new w.LatLngBounds(this.getLatLngFromArray(e[0]),this.getLatLngFromArray(e[1]))),this.bounds},e.prototype.getBounds=function(){return this.bounds!=null?this.bounds:this.calculateBounds()},e.prototype.getCenter=function(){var e,t,n;return this.overlay?this.getArrayFromLatLng((typeof (e=this.overlay).getCenter=="function"?e.getCenter():void 0)||((n=this.getBounds())!=null?n.getCenter():void 0)||(typeof (t=this.overlay).getPosition=="function"?t.getPosition():void 0)):[]},e.prototype.getOverlay=function(){return this.overlay},e.prototype.setOverlay=function(e){return this.overlay=e,this.initEvents()},e.prototype.getFeature=function(){return this.feature},e.prototype.setFeature=function(e){this.feature=e},e.prototype.getGeometryType=function(){return this.geometryType},e.prototype.getDefaultZIndex=function(){var e;return((e=this.feature)!=null?e.getDefaultZIndex():void 0)||b.ZINDEX},e.prototype.getLatLngFromArray=function(e){return e!=null?new w.LatLng(e[0],e[1]):null},e.prototype.getArrayFromLatLng=function(e){return e?[e.lat(),e.lng()]:[]},e.prototype.getLatLngArrayFromArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i},e.prototype.getArrayFromLatLngArray=function(e){var t,n,r,i;if(e){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getArrayFromLatLng(t));return i}return[]},e.prototype.getMap=function(){return this.map},e.prototype.setMap=function(e){var t;return this.map=e,(t=this.overlay)!=null?t.setMap(this.map&&this.map.googleMap?this.map.googleMap:this.map):void 0},e.prototype.getVisible=function(){var e;return(e=this.overlay)!=null?e.getVisible():void 0},e.prototype.setVisible=function(e){var t;return(t=this.overlay)!=null?t.setVisible(e):void 0},e.prototype.setOptions=function(e){var t;return this.options=e,(t=this.overlay)!=null?typeof t.setOptions=="function"?t.setOptions(this.options):void 0:void 0},e.prototype.getIcon=function(){var e;return(e=this.overlay)!=null?typeof e.getIcon=="function"?e.getIcon():void 0:void 0},e.prototype.setIcon=function(e){var t;return(t=this.overlay)!=null?typeof t.setIcon=="function"?t.setIcon(e):void 0:void 0},e.prototype.getIconUrl=function(e){var t;return(t=this.feature)!=null?t.getIconUrl(e):void 0},e.prototype.createIcon=function(e,t){return{path:google.maps.SymbolPath.CIRCLE,scale:5*(t?1.5:1),fillColor:this.getBackgroundColor(),fillOpacity:this.getBackgroundOpacity(),strokeColor:t?1:this.getBorderColor(),strokeOpacity:t?1:this.getBorderOpacity(),strokeWeight:this.getBorderSize()}},e.prototype.updateIcon=function(e){return this.setIcon(this.createIcon(e))},e.prototype.getBorderColor=function(){var e;return((e=this.feature)!=null?e.getBorderColor():void 0)||b.BORDER_COLOR},e.prototype.getBorderOpacity=function(){var e;return((e=this.feature)!=null?e.getBorderOpacity():void 0)||b.BORDER_OPACITY},e.prototype.getBorderSize=function(){var e;return((e=this.feature)!=null?e.getBorderSize():void 0)||b.BORDER_SIZE},e.prototype.getBorderSizeHover=function(){var e;return((e=this.feature)!=null?e.getBorderSizeHover():void 0)||b.BORDER_SIZE_HOVER},e.prototype.getBackgroundColor=function(){var e;return((e=this.feature)!=null?e.getBackgroundColor():void 0)||b.BACKGROUND_COLOR},e.prototype.getBackgroundOpacity=function(){var e;return((e=this.feature)!=null?e.getBackgroundOpacity():void 0)||b.BACKGROUND_OPACITY},e.prototype.getGeoJson=function(){return{type:this.getGeometryType(),coordinates:this.getCoordinates()}},e}(),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.geometryType=t,n.prototype.getOverlayOptions=function(e){return{}},n.prototype.initOverlay=function(e){return this.options=e!=null?e:{},!0},n.prototype.getCoordinates=function(){return[]},n.prototype.setEditable=function(e){return!0},n.prototype.getGeoJson=function(){return null},n}(r),v=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=h,t.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:o,icon:(r=e.icon)!=null?r:this.createIcon(e.zoom)}},t.prototype.initOverlay=function(e){return this.setOverlay(new w.Marker(this.getOverlayOptions(e)))},t.prototype.initEvents=function(e){var n,r=this;return e==null&&(e=this.overlay),t.__super__.initEvents.call(this,e),n=["animation_changed","clickable_changed","cursor_changed","drag","dragend","daggable_changed","dragstart","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"],n.forEach(function(t){return komoo.event.addListener(e,t,function(e,n){return komoo.event.trigger(r,t,e,n)})})},t.prototype.getCoordinates=function(){return this.getArrayFromLatLng(this.overlay.getPosition())},t.prototype.setCoordinates=function(e){return this.bounds=null,this.overlay.setPosition(this.getLatLngFromArray(e)),t.__super__.setCoordinates.call(this,e)},t.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},t.prototype.getPosition=function(){return this.overlay.getPosition()},t.prototype.setPosition=function(e){return this.overlay.setPosition(e instanceof Array?this.getLatLngFromArray(e):e)},t.prototype.addMarker=function(e){return this.setOverlay(e)},t}(r),c=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=a,t.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:o,icon:(r=e.icon)!=null?r:this.createIcon(e.zoom)}},t.prototype.initOverlay=function(e){return this.setOverlay(new MultiMarker(this.getOverlayOptions(e)))},t.prototype.getPoints=function(){return this.overlay.getMarkers().getArray()},t.prototype.setPoints=function(e){return this.overlay.addMarkers(e)},t.prototype.guaranteePoints=function(e){var t,n,r,i,s,o,u,a;n=this.overlay.getMarkers();if(n.length>=e){u=[];for(t=r=0,s=n.length-e-1;0<=s?r<=s:r>=s;t=0<=s?++r:--r)u.push(n.pop());return u}a=[];for(t=i=0,o=e-n.length-1;0<=o?i<=o:i>=o;t=0<=o?++i:--i)a.push(this.overlay.addMarker(new w.Marker(this.options)));return a},t.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e.getPosition()));return i},t.prototype.setCoordinates=function(e){var n,r,i,s,o;e[0]instanceof Array||(e=[e]),this.guaranteePoints(e.length),this.bounds=null,o=this.getPoints();for(n=i=0,s=o.length;i<s;n=++i)r=o[n],r.setPosition(this.getLatLngFromArray(e[n]));return t.__super__.setCoordinates.call(this,e)},t.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},t.prototype.getPositions=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.getPosition());return i},t.prototype.setPositions=function(e){return this.overlay.setPositions(e)},t.prototype.getMarkers=function(){return this.overlay.getMarkers()},t.prototype.addMarkers=function(e){return this.overlay.addMarkers(e)},t.prototype.addMarker=function(e){return this.overlay.addMarker(e)},t}(r),g=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=h,t.prototype.getGeoJson=function(){return{type:a,coordinates:this.getCoordinates()}},t}(c),s=function(e){function t(e){t.__super__.constructor.call(this,e),this.handleEvents()}return __extends(t,e),t.prototype.geometryType=i,t.prototype.getOverlayOptions=function(e){var t,n,r,i,s;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:o,strokeColor:(r=e.strokeColor)!=null?r:this.getBorderColor(),strokOpacity:(i=e.strokeOpacity)!=null?i:this.getBorderOpacity(),strokeWeight:(s=e.strokeWeight)!=null?s:this.getBorderSize()}},t.prototype.initOverlay=function(e){return this.setOverlay(new w.Polyline(this.getOverlayOptions(e)))},t.prototype.handleEvents=function(){var e=this;return komoo.event.addListener(this,"mousemove",function(t){return e.setOptions({strokeWeight:e.getBorderSizeHover()})}),komoo.event.addListener(this,"mouseout",function(t){return e.setOptions({strokeWeight:e.getBorderSize()})})},t.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPath().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e));return i},t.prototype.setCoordinates=function(e){var t;return this.overlay.setPath(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i}.call(this))},t.prototype.setEditable=function(e){return this.overlay.setEditable(e)},t.prototype.getPath=function(){return this.overlay.getPath()},t.prototype.setPath=function(e){return this.overlay.setPath(e)},t}(r),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=f,t.prototype.initOverlay=function(e){return this.setOverlay(new MultiPolyline(this.getOverlayOptions(e)))},t.prototype.guaranteeLines=function(e){var t,n,r,i,s,o,u,a;n=this.overlay.getPolylines();if(n.length>=e){u=[];for(t=r=0,s=n.length-e-1;0<=s?r<=s:r>=s;t=0<=s?++r:--r)u.push(n.pop());return u}a=[];for(t=i=0,o=e-n.length-1;0<=o?i<=o:i>=o;t=0<=o?++i:--i)a.push(this.overlay.addPolyline(new w.Polyline(this.options)));return a},t.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPolylines().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLngArray(e.getPath().getArray()));return i},t.prototype.setCoordinates=function(e){var t,n,r,i,s,o;e[0][0]instanceof Array||(e=[e]),this.guaranteeLines(e.length),this.bounds=null,s=this.getLines(),o=[];for(t=r=0,i=s.length;r<i;t=++r)n=s[t],o.push(n.setPath(this.getLatLngArrayFromArray(e[t])));return o},t.prototype.getBorderSize=function(){return t.__super__.getBorderSize.call(this)+1},t.prototype.getBorderSizeHover=function(){return t.__super__.getBorderSizeHover.call(this)+1},t.prototype.getPath=function(){return this.getPaths().getAt(0)},t.prototype.getPaths=function(){return this.overlay.getPaths()},t.prototype.setPaths=function(e){return this.overlay.setPaths(e)},t.prototype.getLines=function(){return this.overlay.getPolylines().getArray()},t.prototype.setLines=function(e){return this.overlay.addPolylines(e)},t.prototype.addPolyline=function(e,t){return this.overlay.addPolyline(e,t)},t.prototype.getPolylines=function(){return this.overlay.getPolylines()},t}(s),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=p,t.prototype.getOverlayOptions=function(e){var t,n,r,i,s,o,u;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.calculateZIndex(),fillColor:(r=e.fillColor)!=null?r:this.getBackgroundColor(),fillOpacity:(i=e.fillOpacity)!=null?i:this.getBackgroundOpacity(),strokeColor:(s=e.strokeColor)!=null?s:this.getBorderColor(),strokeOpacity:(o=e.strokeOpacity)!=null?o:this.getBorderOpacity(),strokeWeight:(u=e.strokeWeight)!=null?u:this.getBorderSize()}},t.prototype.calculateZIndex=function(){return this.area?510072e9/this.area:this.getDefaultZIndex()},t.prototype.initOverlay=function(e){return this.setOverlay(new w.Polygon(this.getOverlayOptions(e)))},t.prototype.getCoordinates=function(){var e,t,n,r,i,s;e=[],s=this.overlay.getPaths().getArray();for(r=0,i=s.length;r<i;r++)t=s[r],n=this.getArrayFromLatLngArray(t.getArray()),n.length&&n.push(n[0]),n.length>0&&e.push(n);return e},t.prototype.setCoordinates=function(e){var t,n,r,i,s;n=[],this.bounds=null;for(i=0,s=e.length;i<s;i++)r=e[i],t=this.getLatLngArrayFromArray(r),t.pop(),n.push(t);return this.setPaths(n)},t.prototype.getPath=function(){return this.getPaths().getAt(0)},t.prototype.getPaths=function(){return this.overlay.getPaths()},t.prototype.setPaths=function(e){return this.overlay.setPaths(e)},t}(s),window.komoo.geometries={types:{EMPTY:t,POINT:h,MULTIPOINT:a,POLYGON:p,POLYLINE:d,LINESTRING:i,MULTIPOLYLINE:f,MULTILINESTRING:u},MultiMarker:MultiMarker,Geometry:r,Empty:n,Point:g,MultiPoint:c,LineString:s,MultiLineString:l,Polygon:m,defaults:b,makeGeometry:function(e,t){var r,i,s,o,u;s={feature:t,area:(u=e.properties)!=null?u.area:void 0};if(e.geometry==null)return new n(s);o=e.geometry.type,r=e.geometry.coordinates;if(o==="Point")i=new g(s);else if(o==="MultiPoint"||o==="marker")i=new c(s);else if(o==="LineString"||o==="polyline")r&&(r=[r]),i=new l(s);else if(o==="MultiLineString")i=new l(s);else if(o==="Polygon"||o==="polygon")i=new m(s);return r&&i!=null&&i.setCoordinates(r),i}},window.komoo.geometries});