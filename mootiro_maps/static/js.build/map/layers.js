var __indexOf=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},__hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define(["require","./collections"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;return i=e("./collections"),p="/static/",o=["==","is","equal","equals"],l=["!=","isnt","not equal","not equals","different"],a=["in"],s=["contains","has"],c=["!","not"],h=["or"],r=["and"],u=function(e,t){var n,i,f,p,d,v,m,g;if(e==null||t==null)return!1;n=e.operator;if(__indexOf.call(o,n)>=0)return t.getProperty(e.property)===e.value;if(__indexOf.call(l,n)>=0)return!t.getProperty(e.property)===e.value;if(__indexOf.call(a,n)>=0)return v=t.getProperty(e.property),__indexOf.call(e.value,v)>=0;if(__indexOf.call(s,n)>=0&&Object.prototype.toString.call(e.value)==="[object Array]"){i=!0,m=e.value;for(p=0,d=m.length;p<d;p++)f=m[p],i=i&&__indexOf.call(t.getProperty(e.property),f)>=0;return i}if(__indexOf.call(s,n)>=0)return g=e.value,__indexOf.call(t.getProperty(e.property),g)>=0;if(__indexOf.call(c,n)>=0)return!u(e.child,t);if(__indexOf.call(h,n)>=0)return u(e.left,t)||u(e.right,t);if(__indexOf.call(r,n)>=0)return u(e.left,t)&&u(e.right,t)},window.ee=u,n=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.addLayer=function(e){var t;return this.getLayer(e.getName())||this.push(e),(t=e.map)!=null?t.publish("layer_added",e):void 0},t.prototype.getLayer=function(e){var t;return t=this.filter(function(t){return t.getId()===e||t.getName()===e}),t.first},t.prototype.showLayer=function(e){return this.getLayer(e).show()},t.prototype.hideLayer=function(e){return this.getLayer(e).hide()},t.prototype.showAll=function(){return this.forEach(function(e){return e.show()})},t.prototype.hideAll=function(){return this.forEach(function(e){return e.hide()})},t.prototype.getVisibleLayers=function(){return this.filter(function(e){return e.visible})},t.prototype.getHiddenLayers=function(){return this.filter(function(e){return!e.visible})},t.prototype.shouldFeatureBeVisible=function(e){var t;return t=!1,this.getVisibleLayers().forEach(function(n){return t||(t=n.match(e))}),t},t}(i.GenericCollection),t=function(){function e(e){var t,n,r,s,o,u;this.options=e!=null?e:{},this.cache=new i.FeatureCollection,this.visible=(t=this.options.visible)!=null?t:!0,this.icon=(n=(r=this.options.icon)!=null?r[0]:void 0)!=null?n:"",this.iconOff=(s=(o=this.options.icon)!=null?o[1]:void 0)!=null?s:"",this.id=(u=this.options.id)!=null?u:this.options.name,this.setPosition(this.options.position),this.setName(this.options.name),this.setRule(this.options.rule),this.setMap(this.options.map),this.setCollection(this.options.collection)}return e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(e){return this.position=e,this},e.prototype.getId=function(){return this.id},e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){return this.name=e,this},e.prototype.getCollection=function(){return this.collection},e.prototype.setCollection=function(e){return this.collection=e,this.cache.clear(),this},e.prototype.getRule=function(){return this.rule},e.prototype.setRule=function(e){return this.rule=e,this.cache.clear(),this},e.prototype.getIconUrl=function(){return p+(this.visible?this.icon:this.iconOff)},e.prototype.setMap=function(e){var t;return this.map=e,this.handleMapEvents(),typeof (t=this.cache).setMap=="function"?t.setMap(this.map):void 0},e.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("feature_added",function(t){if(!e.cache.isEmpty()&&e.match(t))return e.cache.push(t)})},e.prototype.show=function(){return this.visible=!0,this.getFeatures().show()},e.prototype.hide=function(){return this.visible=!1,this.getFeatures().hide()},e.prototype.toggle=function(){return this.visible?this.hide():this.show(),this.visible},e.prototype.match=function(e){return u(this.rule,e)},e.prototype.getFeatures=function(){return this.cache.isEmpty()&&this.updateCache(),this.cache},e.prototype.updateCache=function(){var e,t=this;return this.cache.clear(),e=this.collection.filter(this.match,this),e.forEach(function(e){return t.cache.push(e)}),this},e}(),f={Layers:n,Layer:t},f});