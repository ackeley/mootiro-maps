var __slice=[].slice,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define(["require","googlemaps"],function(e){var t,n,r,i,s,o,u;return i=e("googlemaps"),(o=window.komoo)==null&&(window.komoo={}),(u=(s=window.komoo).event)==null&&(s.event=i.event),r=function(){function e(e){this.options=e!=null?e:{},this.elements=[],this.length=0}return e.prototype.updateLength=function(){return this.length=this.elements.length,this.first=this.elements[0],this.last=this.elements[this.length-1]},e.prototype.clear=function(){return this.elements=[],this.updateLength()},e.prototype.getAt=function(e){return this.elements[e]},e.prototype.push=function(e){return this.elements.push(e),this.updateLength()},e.prototype.pop=function(){var e;return e=this.elements.pop(),this.updateLength(),e},e.prototype.remove=function(){var e,t,n,r,i,s;t=1<=arguments.length?__slice.call(arguments,0):[],r=[];for(i=0,s=t.length;i<s;i++)e=t[i],n=this.elements.indexOf(e),n!==-1&&r.push(this.elements.splice(n,1));return t.length===1&&(r=r[0]),this.updateLength(),r},e.prototype.isEmpty=function(){return this.elements.length===0},e.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},e.prototype.getArray=function(){return this.elements},e.prototype.slice=function(e,t){return this.elements.slice(e,t)},e.prototype.filter=function(e,t){var n,r;return r=[],this.elements.filter!=null?this.elements.filter!=null&&(r=this.elements.filter(e,t)):this.forEach(function(n){if(e.apply(t,[n]))return r.push(n)}),n=new this.constructor,n.elements=r,n.updateLength(),n},e.prototype.sort=function(e){return this.elements.sort(e)},e.prototype.contains=function(e){return __indexOf.call(this.elements,e)>=0},e}(),t=function(e){function t(e){var n,r=this;e==null&&(e={}),t.__super__.constructor.call(this,e),e.map&&this.setMap(e.map),(n=e.features)!=null&&n.forEach(function(e){return r.push(e)})}return __extends(t,e),t.prototype.push=function(e){if(e==null)return;return t.__super__.push.call(this,e),e.setMap(this.map)},t.prototype.getBounds=function(){var e,t,n,r=this;return e=this.getAt(0),e&&e.getGeometryType()!=="Empty"&&(t=e.getGeometry(),n=t.getLatLngFromArray(t.getCenter()),this.bounds=new i.LatLngBounds(n,n),this.forEach(function(e){var t;if(e.getGeometryType()!=="Empty")return(t=r.bounds)!=null?t.union(e.getBounds()):void 0})),this.bounds},t.prototype.setOutOfBounds=function(e){return this.forEach(function(t){return t.setOutOfBounds(e)})},t.prototype.setMap=function(e,t){var n,r=this;return this.map=e,n=null,this.forEach(function(e){return t!=null&&(n={geometry:t!=null?t.geometry:void 0,point:t!=null?t.icon:void 0,icon:t!=null?t.icon:void 0}),e.getType()==="Community"&&n!=null&&(n.point=!1),e!=null?e.setMap(r.map,n):void 0}),this.handleMapEvents()},t.prototype.show=function(){return this.setMap(this.map,{geometry:!0}),this.setVisible(!0)},t.prototype.hide=function(){return this.setVisible(!1)},t.prototype.getGeoJson=function(e){var t,n;return(n=e.geometryCollection)==null&&(e.geometryCollection=!1),e.geometryCollection?(t={type:"GeometryCollection",geometries:[]},this.forEach(function(e){return t.geometries.push(e.getGeometryGeoJson())})):(t={type:"FeatureCollection",features:[]},this.forEach(function(e){return t.features.push(e.getGeoJson())})),t},t.prototype.removeAllFromMap=function(){return this.forEach(function(e){return e.removeFromMap()})},t.prototype.setVisible=function(e){return this.forEach(function(t){return t.setVisible(e)})},t.prototype.updateFeaturesVisibility=function(){return this.forEach(function(e){return e.seMap(e.getMap())})},t.prototype.handleMapEvents=function(){var e=this;return komoo.event.addListener(this.map,"zoom_changed",function(){})},t.prototype.filter=function(e,n){var r;return r=t.__super__.filter.call(this,e,n),r.map=this.map,r},t}(r),n=function(e){function n(e){e==null&&(e={}),n.__super__.constructor.call(this,e),this.featuresByType={}}return __extends(n,e),n.prototype.push=function(e){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=this;return n.__super__.push.call(this,e),r=e.getType(),(c=(i=this.featuresByType)[r])==null&&(i[r]={}),(h=(s=this.featuresByType[r])["categories"])==null&&(s.categories={}),(p=(o=this.featuresByType[r]["categories"])["all"])==null&&(o.all=new t({map:this.map})),(d=(u=this.featuresByType[r]["categories"])["uncategorized"])==null&&(u.uncategorized=new t({map:this.map})),(v=e.getCategories())!=null&&v.forEach(function(n){var i,s,o;return(o=(i=b.featuresByType[r]["categories"])[s=n.name])==null&&(i[s]=new t({map:b.map})),b.featuresByType[r].categories[n.name].push(e)}),(e.getCategories()==null||e.getCategories().length===0)&&this.featuresByType[r].categories.uncategorized.push(e),this.featuresByType[r].categories.all.push(e),(m=(a=this.featuresByType[r])["ids"])==null&&(a.ids={}),this.featuresByType[r].ids[e.getProperty("id")]=e,(g=(f=this.featuresByType)["all"])==null&&(f.all={}),(y=(l=this.featuresByType["all"])["ids"])==null&&(l.ids={}),this.featuresByType.all.ids[e.getProperty("id")]=e},n.prototype.pop=function(){return n.__super__.pop.call(this)},n.prototype.clear=function(){return this.featuresByType={},n.__super__.clear.call(this)},n.prototype.getByType=function(e,n,r){var i,s=this;return r==null&&(r=!1),this.featuresByType[e]?n?n.length===0?this.featuresByType[e].categories.uncategorized:(i=new t({map:this.map}),n.forEach(function(t){if(s.featuresByType[e].categories[t])return s.featuresByType[e].categories[t].forEach(function(e){if(!r||!e.getCategories()||e.getCategories().length===1)return i.push(e)})}),i):this.featuresByType[e].categories.all:!1},n.prototype.getById=function(e,t){var n;return typeof e!="string"&&(t=e,e="all"),(n=this.featuresByType[e])!=null?n.ids[t]:void 0},n.prototype.highlightFeature=function(e,t){var n,r,i;n=(r=typeof e)==="string"||r==="number"?this.getById(e,t):e;if(n.isHighlighted())return;return(i=this.highlighted)!=null&&i.setHighlight(!1),n.highlight(),this.highlighted=n},n}(t),window.komoo.collections={GenericCollection:r,FeatureCollection:t,FeatureCollectionPlus:n,makeFeatureCollection:function(e){return e==null&&(e={}),new t(e)},makeFeatureCollectionPlus:function(e){return e==null&&(e={}),new n(e)}},window.komoo.collections});